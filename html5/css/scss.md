# Sass & SCSS

<script>ooboqoo.contentsRegExp=/H[123]/</script>

https://sass-lang.com/guide 核心特性(Variables Nesting Modules Mixins Extend Operators)介绍  
http://sass-lang.com/documentation 详细文档

Sass is a *stylesheet language* that’s compiled to CSS. It allows you to use variables, nested rules, mixins, functions, and more, all with a fully CSS-compatible syntax. Sass helps *keep large stylesheets well-organized* and makes it easy to share design within and across projects.


## 1. 概述

#### Install Sass

```bash
$ npm install -g sass
$ sass --watch input.scss output.css  # 监视文件变化，如果依赖了其他文件，其他文件变化时也会触发编译
$ sass --watch app/sass:dist/css      # 监视目录变化，输入输出之间用 `:` 分隔
```

#### Sass vs SCSS

Sass 的原生语法不用花括号和分号，靠缩进和换行来分隔选择符与属性，简洁但可读性差。

SCSS 即 Sassy CSS，语法添加了花括号和分号，与 CSS 的风格保持了一致。SCSS 是 CSS 的超集，所有 CSS 都是有效的 SCSS。SCSS 语法更受欢迎。

```scss
body
  color: $primary-color
```
```scss
body {
  color: $primary-color;
}
```

#### 编码 Encoding

Sass follows the [CSS spec](http://www.w3.org/TR/2013/WD-css-syntax-3-20130919/#determine-the-fallback-encoding) to determine the encoding of a stylesheet.

It will include a `@charset` declaration if and only if the output file contains non-ASCII characters.

```scss
@charset "utf-8";  // 出现中文时加这个以防异常
```


## 2. SassScript

In addition to the plain CSS property syntax, Sass supports a small set of extensions called SassScript. SassScript allows properties to use variables, arithmetic, and extra functions. SassScript can be used in any property value.

### 2.1 变量 Variables

变量以 `$` 开头，多个单词之间推荐用 `-` 分隔。变量的引入为样式编辑带来了巨大的便利。

* 变量可以在任何地方定义
* 变量是有作用域的，划分依据以 `{}` 来划分
* `!default` 可以声明默认值
* `!global` 可以在块内声明全局变量

```scss
$global-variable: global value;  // 全局变量

.content {
  $local-variable: local value;  // 局部变量
  global: $global-variable;
  local: $local-variable;
}

.sidebar {
  global: $global-variable;
  local: $local-variable;     // 报错
}
```

### 2.2 插值 Interpolation `#{}`

可以使用 `#{}` 在 selectors and property names 中插入变量。

虽然在 property values 中直接使用变量是最方便的，但也可以采用插值实现特殊的用法 -- 插值周边的运算符都会被当做普通文本。

```scss
$name: foo;
$attr: border;
$font-size: 12px;
$line-height: 30px;

p.#{$name} {
  #{$attr}-color: blue;
  font: #{$font-size}/#{$line-height};   // 运算符被当做普通文本
  font-size: $font-size / $line-height;  // 正常运算
}

// 输出：
p.foo {
  border-color: blue;
  font: 12px/30px;
  font-size: 0.4; }
```

### 2.3 数据类型 Values

SassScript supports seven main data types:

* Numbers (e.g. `1.2`, `13`, `10px`)
* Strings (e.g. `"foo"`, `'bar'`, `baz`)
* Colors (e.g. `blue`, `#04a3f9`, `rgba(255, 0, 0, 0.5)`)
* boolean (`true`, `false`)
* null (`null`)
* Lists of values, separated by spaces or commas, and optionally encolsed in square brackets (e.g. `1.5em 1em 0 2em`, `Helvetica, Arial, sans-serif`)
* Maps that associate values with keys (e.g. `(key1: value1, key2: value2)`)
* Functions

### 2.4 运算符 Operators

Sass supports a handful of useful operators for working with different values.

### 2.5 函数 Functions

#### 2.5.1 内置函数

```scss
p {
  color: darken(#800, 20%);             // 调暗 darken($color, $amount), $amount: 0%--100%
  color: lighten(hsl(0, 0%, 0%), 30%);  // 调亮 lighten($color, $amount), $amount: 0%--100%
  color: transparentize(#fefefe, 1);    // 调透明度 transparentize($color, $amount)
  color: opacify(#fefefe, .5);          // 调透明度 opacify($color, $amount), $amount: 0--1
}
```

#### 2.5.2 自定义函数 `@function`

```scss
@function sum($left, $right) {
  @return $left + $right;
}

@function em($pixels, $context: 16px) {
  @return ($pixels / $context) * 1em;
}

@function col-width($columns: 12, $page-width: 100%, $gap: 1%) {
  @return ($page-width - $gap * ($columns -1)) / $columns;
}

font-size: em(20px);    // 输出 font-size: 1.25em;
```

```scss
// 函数调用的位参和命名参数参考 Dart
p {
  color: hsl(0, 100%, 50%);
  color: hsl($hue: 0, $saturation: 100%, $lightness: 50%);
}
```

### 2.6 注释

同其他语言一样，可以使用单行注释和多行注释，多行注释格式为 CSS 原生支持，会输出到 CSS 文件中，单行注释为 Sass 增强功能，不会输出到 css 文件。

```scss
/* 多行注释，会输出到 css 文件 */

/*! 多行注释 - 文件注释，即使选择 compressed 模式输出，也会保留，很适合放版权信息 */

// 单行注释不会输出到 css 文件
```

多行注释还支持插值：

```scss
$version: "1.2.3";
/* This CSS is generated by My Snazzy Framework version #{$version}. */    // 插值符号 #{}
```


## 3. 嵌套 Nesting

### 3.1 Nested Rules

Sass 使得编写样式也可以像 HTML 一样实现嵌套，比 CSS 的语法更加直观，但过深的嵌套不利于维护，应该避免。

```scss
nav {
  ul { list-style: none; }
  li { display: inline-block; }
}
// 输出
```

```css
nav ul { list-style: none; }
nav li { display: inline-block; }
```

### 3.2 Parent Selector `&`

嵌套编译时，默认父选择器会放在最前面且后面有空格分隔，但有时，这种组合不是我们想要的，`&` 符号提供了控制父选择器位置的途径。另外，`&` 必须作为单独的选择符或者作为前缀使用，但不能出现在其他位置。

```scss
a {
  text-decoration: none;
  &:hover { text-decoration: underline; }  // 1 常见用法
  body.firefox & { font-weight: normal; }  // 2 还可以出现在其他位置
  &--block { display: block; }             // 3 还可以带后缀使用，但像 .sidebar-& 这样就不会解析，原样输出
}
```

### 3.3 `@at-root`

`@at-root` 指令会将嵌套在内层的选择器提升到顶层(即根级)，灵活使用可以实现一些高级的选择器写法。

```scss
@use "sass:selector";

@mixin unify-parent($child) {
  @at-root #{selector.unify(&, $child)} {
    @content;
  }
}

.wrapper .field {
  @include unify-parent('input') {
    color: red;
  }
}
// 输出
.wrapper input.field {
  color: red;
}
```

### 3.4 Nested Properties

CSS 本身的一些属性如 font border 等相当于起了 “命名空间” 的作用，在 Sass 中你可以采用嵌套的写法避免逐条输入。

```scss
.funky {
  font: 20px/24px fantasy {
    weight: bold;
  }
}

// 输出
.funky {
  font: 20px/24px fantasy;
  font-weight: bold;
}
```


## 4. 模块 Modules/Partials

Dart Sass 1.23.0 之前并没有模块这个概念，2019年末才引入。没有引入模块概念之前，`@import` 只是简单地将文件进行拼接，导致不同文件之间定义的 variable, mixin, function 等相互覆盖等问题。

### 4.1 部件 Partials

If you have a SCSS or Sass file that you want to import but don’t want to compile to a CSS file, you can add an underscore to the beginning of the filename. This will tell Sass not to compile it to a normal CSS file. You can then import these files without using the underscore.

部件可以将 css 编辑工作模块化。部件默认以下划线`_`开头，如 `_variables.scss`。部件不会单独输出 CSS 文件。

```scss
// 在其他文件中导入 _variables.scss
@import "variables";  // 不需要前面的下划线，也不用扩展名，解析器会自动处理
```

### 4.2 `@import`

CSS 原生支持 `@import`，但其缺点是，每次 inport 都会产生一个 HTTP 请求，而 Sass 则会将这些部件编译到一个文件内。

Sass 不仅支持导入自己的 scss 文件，同时也支持 CSS 的原生 `@import` 指令（这种情况下，css 文件不会被嵌入进来）：

```scss
// 以下情况都会以 css 规则处理 --- 也就是不做处理，原样保留
@import url(foo);               // url()
@import "http://";              // 文件名以 http:// 开头
@import "filename.css";         // 文件名后缀为 .css，注意，不带后缀使用的 css 文件还是会被编译到一起的
@import "style-screen" screen;  // 带媒体查询
```

Sass 还支持插值啊什么的

```scss
@mixin google-font($font) {
  $font: unquote($font);
  @import url(https://fonts.googleapis.com/css?family=#{$font})  // #{$font} 
}
@include google-font("Titllium+web");

// 输出
@import url(https://fonts.googleapis.com/css?family=Titllium+web);
h1 { font-family: "Tillium Web"; }
```

Although most of the time it’s most useful to just have `@import`s at the top level of the document, it is possible to include them within CSS rules and `@media` rules.

### 4.3 `@use`

引入模块概念后，团队引入了一个新的指令 `@use`，用于与老的 `@import` 做区分。

* `@use` only executes a stylesheet and includes its CSS once, no matter how many times that stylesheet is used.
* `@use` only makes names available in the current stylesheet, as opposed to globally.
* Members whose names begin with `-` or `_` are private to the current stylesheet with `@use`.
* If a stylesheet includes `@extend`, that extension is only applied to stylesheets it imports, not stylesheets that import it.

```scss
@use "bootstrap";

.element {
  background-color: bootstrap.$body-bg;
  @include bootstrap.float-left;
}
```

```scss
@use "bootstrap" as b;

.element {
  @include b.float-left;
}
```

如果不想像上面那样麻烦，还保持以前的用法的话，可以使用 `as *`，不过跟 `@import` 还是有区别的，当出现命名冲突时，使用 `@use` 会报错。

```scss
@use "bootstrap" as *;

.element {
  @include float-left;
}
```

with `@use`, it supports a more explicit way of configuring libraries: the `with` clause.

```scss
// bootstrap.scss
$paragraph-margin-bottom: 1rem !default;

p {
  margin-top: 0;
  margin-bottom: $paragraph-margin-bottom;
}
```

```scss
@use "bootstrap" with (
  $paragraph-margin-bottom: 1.2rem
);
```

### 4.4 `@forward`

```scss
@forward "variables";                 // 导入并导出所有内容
@forward "mixin" hide clearfix;       // 导出除 xxx 外的其他所有内容
@forward "functions" show color-yiq;  // 仅导出 xxx
```

Extra Prefixing

```scss
@forward "theme" as theme-*;
```

```scss
@use "material" with ($theme-primary: blue);
@use "material/theme" with ($primary: blue);
```


## 5. 混入 Mixins

注：Sass 的写法还支持简写 `=` 换 `@mixin`, `+` 换 `@include`，但 SCSS 下并不支持。

### 5.1 定义 `@mixin`

```scss
@mixin button-base() {
  @include typography(button);
  @include ripple-surface;

  display: inline-flex;
  height: $button-height;

  &:hover { cursor: pointer; }
}
```

### 5.2 使用 `@include`

### 5.3 参数 Arguments

```scss
// 1 普通混入
@mixin warning {
  background-color: orange;
  color: #fff;
}

.warning-button {
  @include warning;
  padding: 8px 12px;
}

// 2 带参混入
@mixin rounded($radius) {
  border-radius: $radius;
}

// 3 带参混入 - 默认值
@mixin box($radius: 6px, $border: 1px solid #000) {
  @include round($radius);
  border: $border;
}

// 4 带参混入 - 扩展符号
@mixin box-shadow($shadows...) {    // 通过附加扩展符号，可以实现多参传入
  box-shadow: $shadows;
  -moz-box-shadow: $shadows;
  -webkit-box-shadow: $shadows;
}

#header {
  @include box($border: 1px solid #fff, $radius: 12px)  // 参数顺序可以随意
  @include box($border: 1px solid #fff)                 // 可以省略参数(前提是省略参数带默认值)
  @include box-shadow(2px 0 4px #999, 1px 1px 6px $secondary-color);
}
```

### 5.4 插槽 `@content`

```scss
@mixin apply-to-ie6 {
  * html { @content; }
}
@include apply-to-ie6 {
  body { font-size: 125% }
}

// 最终输出的效果
* html {
  body { font-size: 125%; }
}
```


## 6. 扩展 Extend/Inheritance

### 6.1 `@extend`

使用 `@mixin` 会复制所有定义，而 `@extend` 只会将选择器添加到基类，可以减小 CSS 尺寸。

```scss
.error {
  background-color: #fdd;
}
.attention {
  background-color: #ff0;
}
.seriousError {
  @extend .error;
  @extend .attention;
  border-width: 3px;
}

// 输出
.error, .seriousError {
  background-color: #fdd;
}
.attention, .seriousError {
  background-color: #ff0;
}
.seriousError {
  border-width: 3px;
}
```

### 6.2 Placeholder Selectors `%`

就像 `#` `.` 分别作为 id 和 class 的前缀一样，sass 定义了 `%` 来表示仅供继承的特殊类，其自身不会输出到 css。

```scss
.alert:hover, %strong-alert {
  font-weight: bold;
}

%strong-alert:hover {
  color: red;
}

.alert--error {
  @extend %strong-alert;
}

// 输出:
.alert:hover, .alert--error {
  font-weight: bold;
}
.alert--error:hover {
  color: red;
}
```


## 7. 指令 Directives

Sass supports all CSS3 **@-rules**, as well as some additional Sass-specific ones known as “**directives**”. These have various effects in Sass, detailed below. See also **control directives** and **mixin directives**.

### 7.1 `@media`

@media directives in Sass behave just like they do in plain CSS, with one extra capability: they can be nested in CSS rules. If a @media directive appears within a CSS rule, it will be bubbled up to the top level of the stylesheet, putting all the selectors on the way inside the rule.

```scss
.sidebar {
  width: 300px;
  @media screen and (orientation: landscape) {  // @media 会自动冒泡到最外层
    width: 500px;
  }
}

// 输出
.sidebar { width: 300px; }
@media screen and (orientation: landscape) {
  .sidebar { width: 500px; }
}
```
