# Sass & Scss

http://sass-lang.com/documentation/file.SASS_REFERENCE.html

## 概述

### 安装

先安装 Ruby 然后再用以下命令安装：

```bash
$ gem install sass
$ sass -v
```

也可以安装 node-sass，可以免去安装 Ruby。

node-sass 安装过程中需要去亚马逊云下载一个二进制包，然后就容易出现 "网络问题"，需要带梯子安装或使用淘宝镜像。

#### 解决方法 （参考：https://github.com/lmk123/blog/issues/28 ）

直接运行下面的命令即可：

```bash
$ npm install -g node-sass --sass-binary-site=http://npm.taobao.org/mirrors/node-sass/
```

我们可能更希望能直接使用 `npm install` 安装所有依赖，所以我的做法是在项目内添加一个 `.npmrc` 文件：

```
phantomjs_cdnurl=http://cnpmjs.org/downloads
sass_binary_site=https://npm.taobao.org/mirrors/node-sass/
registry=https://registry.npm.taobao.org
```

这样使用 `npm install` 安装 node-sass 和 phantomjs 时都能自动从淘宝源上下载，但是在使用 `npm publish` 的时候要把 registry 这一行给注释掉，否则就会发布到淘宝源上去了。

#### 测试安装是否成功

创建文件 style.scss，并输入：

```scss
body {
  background-color: #eee;
  color: #800;
  p {
    color: #008;
  }
}
```

然后在终端输入命令 `sass` 或 `scss` 编译：

```bash
scss input.scss output.css                                   # 编译单个文件，scss 是 sass --scss 的别名
sass --watch app/sass:public/style                           # 文件监视，输出前用 : 引导
sass --style nested(default), compact, compressed, expanded  # 设定输出风格
```

如果一切正常，会在当前目录生成 style.css 文件。

### Sass 与 SCSS 的区别

Sass 的原生语法不用花括号和分号，靠缩进和换行来分隔选择符与属性，简洁但可读性差；  
而 SCSS 即 Sassy CSS，语法添加了花括号和分号，与 CSS 的风格保持了一致，SCSS 语法更受欢迎。

```sass
// .sass
$font-stack:    Helvetica, sans-serif
$primary-color: #333

body
  font: 100% $font-stack
  color: $primary-color
```
```scss
// .scss
$font-stack:    Helvetica, sans-serif;
$primary-color: #333;

body {
  font: 100% $font-stack;
  color: $primary-color;
}
```

### 注释
同其他语言一样，可以使用单行注释和多行注释，多行注释格式为 CSS 原生支持，会输出到 CSS 文件中，单行注释为 Sass 增强功能，不会输出到 css 文件。

```scss
/* 多行注释，会输出到 css 文件 */

/*
 * 多行注释，会输出到 css 文件
 */

/*! 多行注释 - 文件注释，即使选择 compressed 模式输出，也会保留，很适合放版权信息 */

// 单行注释不会输出到 css 文件
```

多行注释还支持插值：

```scss
$version: "1.2.3";
/* This CSS is generated by My Snazzy Framework version #{$version}. */    // 插值符号 #{}

// 输出：
/* This CSS is generated by My Snazzy Framework version 1.2.3. */
```



## SassScript

### 变量 Variables

变量以 `$` 开头，多个单词之间推荐用 `-` 分隔。变量的引入为样式编辑带来了巨大的便利。

```scss
$text-color: #222;
$header-height: 60px;

#header {
  color: $text-color;
  height: $header-height;
}
```


Sass 的 **变量是有作用域** 的，划分依据以 `{}` 来划分，规则跟 JavaScript 是非常相似的，具体参阅：   
http://webdesign.tutsplus.com/articles/understanding-variable-scope-in-sass--cms-23498

Sass 支持两种变量类型：局部变量 和 全局变量：

* By default, all variables defined outside of any selector are considered global variables. That means they can be accessed from anywhere in our stylesheets.
* On the other hand, local variables are those which are declared inside a selector. Later, we’ll examine how we can customize that behavior.

Here we define a mixin and then the btn-bg-color variable within it. This is a local variable, and is therefore visible only to the code inside that mixin:

```
@mixin button-style {
    $btn-bg-color: lightblue;
    color: $btn-bg-color;
}

#main {
  $width: 5em !global;  // 添加 !global 将局部变量转换成全局变量
  width: $width;
}
```


#### Variable Defaults: `!default`

You can assign to variables if they aren’t already assigned by adding the `!default` flag to the end of the value. This means that if the variable has already been assigned to, it won’t be re-assigned, but if it doesn’t have a value yet, it will be given one.

For example:

```scss
$content: "First content";
$content: "Second content?" !default;
$new_content: "First time reference" !default;

#main {
  content: $content;
  new-content: $new_content;
}
```

is compiled to:

```scss
#main {
  content: "First content";
  new-content: "First time reference"; }
```

Variables with `null` values are treated as unassigned by `!default`:

```scss
$content: null;
$content: "Non-null content" !default;

#main {
  content: $content;
}
```

is compiled to:

```css
#main {
  content: "Non-null content"; }
```

### 数据类型 Data Types

#### Strings

CSS 中字符串可以同时使用 `""` `''` 或不带引号使用，Sass 中也完全一样，Sass 不会去转换格式，除了一种情况：当使用 `#{}` 插值表达式时，Sass 会去除引号，这样做是为了 This makes it easier to use e.g. selector names in mixins.

#### Lists

#### Maps

```scss
$map: (
  key: value,
  other-key: other-value
);
```

Sass 中的 map 与 json 格式有几分相似，最大的不同是，map 使用 `()` 来包裹，另外需要注意的是

* There are a lot of functions to let you manipulate maps
* Last key/value pair in a map can optionally be followed by an extra comma
* Keys must be unique
* Keys and values can be any Sass type, including lists and other maps.

####Colors


## 嵌套 Nesting

Sass 使得编写样式也可以像 HTML 一样实现嵌套，比 CSS 的语法更加直观，但过深的嵌套不利于维护，应该避免。。

```scss
nav {
  ul {
    margin: 0;
    padding: 0;
    list-style: none;
  }

  li { display: inline-block; }

  a {
    display: block;
    padding: 6px 12px;
    text-decoration: none;
  }
}
```

## 部件 Partials

通过部件可以将 css 编辑工作模块化。

默认使用下划线表示部件，如 _variables.scss。编译器碰到以下划线开始文件，不会单独输出 CSS 文件。

```scss
// 在其他文件中导入 _variables.scss
@import "variables";  // 不需要前面的下划线，也不用扩展名，解析器会自动处理
```

## 导入 @import

CSS 原生支持 `@import`，但其缺点是，每次 inport 都会产生一个 HTTP 请求，而 Sass 则会将这些部件编译到一个文件内。

Sass 不仅支持导入自己的 scss 文件，同时也支持 CSS 的原生 `@import` 指令（这种情况下，css 文件不会被嵌入进来）：

```css
@import url()
@import "http://"
@import "filename.css"
@import "style-screen" screen;
```

Sass 还支持插值啊什么的

```scss
@mixin google-font($font) {
  $font: unquote($font);
  @import url(https://fonts.googleapis.com/css?family=#{$font})  // #{$font} 
}

@include google-font("Titllium+web");

// 输出
@import url(https://fonts.googleapis.com/css?family=Titllium+web);
h1 {
  font-family: "Tillium Web";
}
```

## 混入 Mixins

```scss
// 1 普通混入
@mixin warning {
  background-color: orange;
  color: #fff;
}

.warning-button {
  @include warning;
  padding: 8px 12px;
}

// 2 带参混入
@mixin rounded($radius) {
  border-radius: $radius;
}

// 3 带参混入 - 默认值
@mixin box($radius: 6px, $border: 1px solid #000) {
  @include round($radius);
  border: $border;
}

// 4 带参混入 - 扩展符号
@mixin box-shadow($shadows...) {    // 通过附加扩展符号，可以实现多参传入
  box-shadow: $shadows;
  -moz-box-shadow: $shadows;
  -webkit-box-shadow: $shadows;
}

#header {
  @include box($border: 1px solid #fff, $radius: 12px)  // 参数顺序可以随意
  @include box($border: 1px solid #fff)                 // 可以省略参数(前提是省略参数带默认值)
  @include box-shadow(2px 0 4px #999, 1px 1px 6px $secondary-color);
}
```

## 扩展 @extend

使用 @mixin 会复制所有定义，而 @extend 只会将选择器添加到基类，可以减小 CSS 尺寸。

```scss
.message {
  border: 1px solid #ccc;
  padding: 10px;
  color: #333;
}

.success {
  @extend .message;
  border-color: green;
}

.error {
  @extend .message;
  border-color: red;
}

.warning {
  @extend .message;
  border-color: yellow;
}

// 输出
.message, .success, .error, .warning {
  border: 1px solid #ccc;
  padding: 10px;
  color: #333; }

.success {
  border-color: green; }

.error {
  border-color: red; }

.warning {
  border-color: yellow; }
```

### Placeholder Selectors: `%`

`%` 符号用来创建专用于 @extend 的类，其本身不会输出的 css 文件中。

```scss
// This ruleset won't be rendered on its own.
#context a%extreme {
  color: blue;
}

.notice {
  @extend %extreme;
}

// 输出:
#context a.notice {
  color: blue; }
```

### 可选继承标志 The !optional Flag

```scss
a.important {
  @extend .notice !optional;  // 存在 .notice 就继承否则忽略
}
```

## 运算符 Operators

Sass 支持 `+`, `-`, `*`, `/`, `%` 等算术运算符。

```scss
.container { width: 100%; }

article[role="main"] {
  float: left;
  width: 600px / 960px * 100%;    // 输出 width: 62.5%;
}
```

## 高级特性

### 自定义父选择器位置  Referencing Parent Selectors: &

嵌套编译时，默认父选择器会放在最前面且后面有空格分隔，但有时，这种组合不是我们想要的，`&` 符号提供了控制父选择器位置的途径。另外，`&` 还可以带后缀使用。

```scss
a {
  text-decoration: none;
  &:hover { text-decoration: underline; }    // 1 常见用法
  body.firefox & { font-weight: normal; }    // 2 还可以出现在其他位置
}

#main {
  color: black;
  &-sidebar { border: 1px solid; }           // 3 还可以带后缀使用，但像 sidebar-& 这样就不行
}

// 输出
a {
  text-decoration: none; }
  a:hover {
    text-decoration: underline; }
  body.firefox a {
    font-weight: normal; }

#main {
  color: black; }
  #main-sidebar {
    border: 1px solid; }
```

### 属性名嵌套

CSS 本身的一些属性如 font border 等相当于起了 “命名空间” 的作用，在 Sass 中你可以采用嵌套的写法避免逐条输入。

```scss
.funky {
  font: {
    family: fantasy;
    size: 30em;
    weight: bold;
  }
}

.funky {
  font: 20px/24px fantasy {
    weight: bold;
  }
}

// 输出
.funky {
  font-family: fantasy;
  font-size: 30em;
  font-weight: bold; }

.funky {
  font: 20px/24px fantasy;
    font-weight: bold; }
```



### Interpolation: #{}

可以使用 `#{}` 在 selectors and property names 中插入变量。

虽然在 property values 中直接使用变量是最方便的，但也可以采用插值实现特殊的用法 -- 插值周边的运算符都会被当做普通文本。

```scss
$name: foo;
$attr: border;
$font-size: 12px;
$line-height: 30px;
p.#{$name} {
  #{$attr}-color: blue;
  font: #{$font-size}/#{$line-height};
  font-size: $font-size / $line-height;
}

// 输出：
p.foo {
  border-color: blue;
  font: 12px/30px;
  font-size: 0.4; }
```

### @content    Passing Content into Mixins

```scss
@mixin apply-to-ie6 {
  * html {
    @content;
  }
}

@include apply-to-ie6 {
  body {
    font-size: 125%
  }
}

// 最终输出的效果
* html {
  body {
    font-size: 125%;
  }
}
```

## Nested Media Queries

```scss
#main {
  width: $content-width;
  @media (max-width: 960px) {  // 最终 @media 会自动冒泡到外层
    width: auto;
    max-width: $content-width;
  }
}
```

## @-Rules and Directives

@import
Partials
Nested @import
@media
@extend
How it Works
Extending Complex Selectors
Multiple Extends
Chaining Extends
Selector Sequences
Merging Selector Sequences
@extend-Only Selectors
The !optional Flag
@extend in Directives
@at-root
@at-root (without: ...) and @at-root (with: ...)
@debug
@warn
@error

## Control Directives & Expressions

### if()
### @if

```scss
// === THEME ===
// Allowed values: Dark, Light, Default

// === COLORs ===
$text-color: #222;
$body-background-color: #fff;

@if $theme == Dark {
  $text-color: #fff;
  $body-background-color: #222;
} @else if $theme == Light {
  $text-color: #000;
  $body-background-color: #fff;
}
```

### @for

```scss
@for $i from 1 through 6 {
  .col-#{$i} {
    width: $i * 2em;
  }
}
```

### @each

```scss
/*
@each $header, $size in (h1: 2em, h2: 1.5em, h3: 1.2em) {
  #{$header} {
    font-size: $size;
  }
}
*/
// 输出
h1 {
  font-size: 2em; }
h2 {
  font-size: 1.5em; }
h3 {
  font-size: 1.2em; }
```

### @while


## 函数 Functions

### 内置函数

```scss
p {
  color: darken(#800, 20%);             // 调暗 darken($color, $amount), $amount: 0%--100%
  color: lighten(hsl(0, 0%, 0%), 30%);  // 调亮 lighten($color, $amount), $amount: 0%--100%
  color: transparentize(#fefefe, 1);    // 调透明度 transparentize($color, $amount)
  color: opacify(#fefefe, .5);          // 调透明度 opacify($color, $amount), $amount: 0--1
}
```

### 自定义函数

```scss
@function sum($left, $right) {
  @return $left + $right;
}

@function em($pixels, $context: 16px) {
  @return ($pixels / $context) * 1em;
}

@function col-width($columns: 12, $page-width: 100%, $gap: 1%) {
  @return ($page-width - $gap * ($columns -1)) / $columns;
}

font-size: em(20px);    // 输出 font-size: 1.25em;
```

## 输出风格 Output Style

Sass 提供 4 种输出风格供选择，可以通过设置 `:style` 选项或在命令行中用 `--style` flag 指定.

```css
// :nested (default) 嵌套风格，能较好地体现嵌套层次 #############################
#main {
  color: #fff;
  background-color: #000; }
  #main p {
    width: 10em; }

.huge {
  font-size: 10em;
  font-weight: bold;
  text-decoration: underline; }

// :expanded 扩展风格，模仿手工编写的格式 #######################################
#main {
  color: #fff;
  background-color: #000;
}
#main p {
  width: 10em;
}

.huge {
  font-size: 10em;
  font-weight: bold;
  text-decoration: underline;
}

// :compact 紧凑风格，更加关注选择符 #############################################
#main { color: #fff; background-color: #000; }
#main p { width: 10em; }

.huge { font-size: 10em; font-weight: bold; text-decoration: underline; }

// :compressed 压缩风格，做了必要的精简优化 ######################################
#main{color:#fff;background-color:#000}#main p{width:10em}.huge{font-size:10em;font-weight:bold;text-decoration:underline}
```

## 问题处理

#### 有中文字报错
首行加 `@charset "utf-8";` 即可解决。


