<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/lib/html-main.css">
<style>
#article p.t{margin: 2px 0;padding: 2px 10px;color:#c00;border:1px dotted #999;font-size:15px}
#article p.t span{color:#00f;}
</style>
<script src="/lib/html-main.js"></script>
<title>SQL 速查表</title>
</head>
<body>
<div id="article">
<h1>SQL 快速参考</h1>

<div>
<h2>Most Common</h2>

<h3>SELECT</h3>
<p class="t"><span>SELECT</span> [options] items [INTO file_details] <span>FROM</span> tables [<span>WHERE</span> conditions] [<span>GROUP BY</span> group_type] [<span>HAVING</span> where_definition] [<span>ORDER BY</span> order_type] [<span>LIMIT</span> limit_criteria] [PROCEDURE pro_name(arguments)] [lock_options];</p>
<pre>SELECT * FROM table_name
SELECT CustomerName,City FROM Customers;</pre>

<h3>UPDATE</h3>
<p class="t"><span>UPDATE</span> [LOW_PRIORITY] [IGNORE] tablename <span>SET</span> column1=new_value[, column2=new_value...]<br>[<span>WHERE</span> column_name=some_value]</p>
<pre>UPDATE Customers SET ContactName='Alfred', City='Hamburg' WHERE CustomerName='Alfreds';</pre>
<p>!! Be careful when updating records. If we had omitted the WHERE clause...</p>

<h3>INSERT INTO</h3>
<p class="t"><span>INSERT INTO</span> table_name <span>VALUES</span> (value1, value2,...)</p>
<p class="t"><span>INSERT INTO</span> table_name (column_name1, column_name2,...)	<span>VALUES</span> (value1, value2,...)</p>
<pre>INSERT INTO Customers (CustomerName, City, Country) VALUES ('Cardinal', 'Stavanger', 'Norway');</pre>	

<h3>DELETE FROM</h3>
<p class="t"><span>DELETE FROM</span> table_name (<em>Note: </em>Deletes the entire table!!)</p>
<p class="t"><span>DELETE FROM</span> table_name <span>WHERE</span> condition</p>

<h3>DISTINCT</h3>
<p class="t"><span>SELECT DISTINCT</span> column_name(s) <span>FROM</span> table_name</p>
<pre>SELECT DISTINCT City FROM Customers;</pre>

<h3>WHERE</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table_name <span>WHERE</span> condition(column_name operator value)</p>
<pre>SELECT * FROM Customers WHERE Country='Mexico' AND CustomerID=1;</pre>
<p class="t">Operators: = | > | < | >= | <= | <> 或 != | IS NULL | IS NOT NULL | BETWEEN | IN | NOT IN | LIKE | NOT LIKE | REGEXP</p>

<h3>AND / OR</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table_name <span>WHERE</span> condition1 <span>AND|OR</span> condition2</p>
<pre>SELECT * FROM Customers WHERE Country='Germany' AND (City='Berlin' OR City='Munchen');</pre>
</div>

<div>
<h2>ADVANCED</h2>

<h3>TOP / LIMIT / WHERE ROWNUM</h3>
<p class="t"><span>SQLServer</span> SELECT TOP number|percent column_name(s) FROM table_name</p>
<p class="t"><span>MySQL</span> SELECT column_name(s) FROM table_name LIMIT number</p>
<p class="t"><span>Oracle</span> SELECT column_name(s) FROM table_name WHERE ROWNUM <= number</p>
<pre>SELECT TOP 2 * FROM Customers;<br>SELECT TOP 50 PERCENT * FROM Customers;</pre>

<h3>LIKE</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table_name <span>WHERE</span> column_name (<span>NOT</span>) <span>LIKE</span> pattern</p>
<pre>SELECT * FROM Customers WHERE City LIKE 's%';<br>SELECT * FROM Customers WHERE Country NOT LIKE '%land%';</pre>
<p class="t">Wildcards:<br><span>%</span> A substitute for zero or more characters; <br><span>_</span> A substitute for a single character; <br><span>[...]</span> Sets and ranges of characters to match; <br><span>[^...]</span> or <span>[!...]</span> Matches only a character NOT specified within the brackets</p>

<h3>IN</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table_name<span>WHERE</span> column_name <span>IN</span> (value1,value2,..)</p>
<pre>SELECT * FROM Customers WHERE City IN ('Paris','London');</pre>

<h3>BETWEEN</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table_name<br><span>WHERE</span> column_name (<span>NOT</span>) <span>BETWEEN</span> value1 <span>AND</span> value2</p>
<pre>
SELECT * FROM Products WHERE (Price BETWEEN 10 AND 20) AND NOT CategoryID IN (1,2,3);
SELECT * FROM Products WHERE ProductName NOT BETWEEN 'C' AND 'M';
SELECT * FROM Orders WHERE OrderDate BETWEEN #07/04/1996# AND #07/09/1996#;
</pre>

<h3>AS (alias for column)</h3>
<p class="t">SELECT column_name AS column_alias FROM table_name</p>
<pre>SELECT CustomerName AS Customer, ContactName AS [Contact Person] FROM Customers;</pre>
<p class="tip"><span>Tips:</span> It requires quotation marks or square brackets if the column name contains spaces</p>
<p class="t"><span>SQLServer</span> SELECT column_name + ... AS column_alias FROM table_name</p>
<p class="t"><span>MySQL</span> SELECT CONCAT(column_names) AS column_alias FROM table_name</p>
<pre>SELECT CustomerName, Address+', '+City+', '+PostalCode+', '+Country AS Address FROM Customers;<br>SELECT CustomerName, CONCAT(Address,', ',City,', ',PostalCode,', ',Country) AS Address FROM Customers;</pre>

<h3>AS (alias for table)</h3>
<p class="t">SELECT column_name FROM table_name&nbsp; AS table_alias</p>
<pre>SELECT o.OrderID, o.OrderDate, c.CustomerName FROM Customers AS c, Orders AS o<br />WHERE c.CustomerName="Around the Horn" AND c.CustomerID=o.CustomerID;<br><em>Remarks: </em>Here we have used aliases to make the SQL shorter</pre>
<p class="tip">Aliases can be useful when:</p>
<ul>
<li>There are more than one table involved in a query</li>
<li>Functions are used in the query</li>
<li>Column names are big or not very readable</li>
<li>Two or more columns are combined together</li>
</ul>


<h3>INNER JOIN</h3>
<p class="t"><span>SELECT</span> column_name(s) <span>FROM</span> table1 <span><del>INNER</del> JOIN</span> table2<br><span>ON</span> table1.column_name=table2.column_name;</p>
<p class="tip">PS: INNER JOIN is the same as JOIN.</p>
<pre>
SELECT Customers.CustomerName, Orders.OrderID FROM Customers INNER JOIN Orders
ON Customers.CustomerID=Orders.CustomerID ORDER BY Customers.CustomerName;
</pre>

<h3>LEFT JOIN</h3>
<p class="t">SELECT column_name(s) FROM table1 LEFT JOIN table2<br /> ON table1.column_name=table2.column_name;</p>
<p class="tip">PS: In some databases LEFT JOIN is called LEFT OUTER JOIN.</p>		

<h3>RIGHT JOIN</h3>
<p class="t">SELECT column_name(s) FROM table1 RIGHT JOIN table2<br /> ON table1.column_name=table2.column_name;</p>
<p class="tip">PS: In some databases RIGHT JOIN is called RIGHT OUTER JOIN.</p>		

<h3>FULL OUTER JOIN</h3>
<p class="t">SELECT column_name(s)FROM table1 FULL OUTER JOIN table2 <br />ON table1.column_name=table2.column_name;</p>

<h3>自连接是指使用表的别名实现表与其自身连接的查询方法</h3>
<p>c27案列根据其他用户推荐书签的例子，具体自连接效果可通过mysql命令行查看效果</p>
<pre>select bm_URL from bookmark where username in
(select distinct(b2.username) from bookmark <del>AS</del> b1, bookmark <del>AS</del> b2
where b1.username="someone" and b1.username != b2.username and b1.bm_URL = b2.bm_URL)
and bm_URL not in (select bm_URL from bookmark where username="someone")
group by bm_url having count(bm_url)>1;</pre>

<h3>UNION</h3>
<p class="t">SELECT column_name(s) FROM table1 UNION (ALL) SELECT column_name(s) FROM table2</p>
<p class="tip">PS: UNION returns only distinct values, and UNION ALL returns duplicate values also</p>
<pre>
SELECT City, Country FROM Customers WHERE Country='Germany' UNION ALL
SELECT City, Country FROM Suppliers WHERE Country='Germany' ORDER BY City;
</pre>

<h3>SELECT INTO (used to create backup copies of tables)</h3>
<p class="t">SELECT column_name(s) INTO new_table_name [IN externaldb] FROM original_table_name</p>
<pre>SELECT CustomerName, ContactName AS NewName INTO CustomersBackup2013 FROM Customers;</pre>

<h3>INSERT INTO SELECT</h3>
<p class="t">INSERT INTO table2 (column_name(s)) SELECT column_name(s) FROM table1;</p>
<pre>INSERT INTO Customers (CustomerName, Country) SELECT SupplierName, Country FROM Suppliers
WHERE Country='Germany';</pre>
</div>

<div>
<h2>Administer</h2>

<h3>命令行批处理</h3>
<p class="t"># mysql -u root -p &lt; filename.sql</p>

<h3>CREATE DATABASE</h3>
<p class="t">CREAT DATABASE database_name</p>

<h3>DROP DATABASE</h3>
<p class="t">DROP DATABASE database_name</p>

<h3>SHOW</h3>
<p class="t">SHOW DATABASES [like_or_where]<br>
SHOW TABLES [FROM database][like_or_where]<br>
SHOW COLUMS FROM table [FROM database][like_or_where]<br>
SHOW INDEX FROM table [FROM database]<br>
SHOW GRANTS FOR user<br>
DESCRIBE table [column]</p>

<h3>GRANT</h3>
<p class="t">GRANT privileges [columns] ON item TO user_name [IDENTIFIED BY 'password']<br>[REQUIRE ssl_options] [WITH [GRANT OPTION | limit_options] ]</p>

<h3>REVOKE</h3>
<p class="t">REVOKE privileges [(columns)] ON item FROM user_name<br>REVOKE ALL PRIVILEGES, GRANT FROM user_name</p>

<h3>LOAD DATA INFILE</h3>
<p class="t">LOAD DATA INFILE "filename" INTO TABLE tablename</p>

<h3>OPTIMIZE</h3>
<p class="t">OPTIMIZE TABLE tablename</p>
</div>

<div>
<h2>TABLE & INDEX</h2>

<h3>CREATE TABLE</h3>
<p class="t">CREATE TABLE table_name (column_name1 data_type(size), column_name2 data_type(size),....);</p>
<pre>CREATE TABLE Persons (PersonID int unsigned not null auto_increment primary key,
LastName varchar(255), FirstName varchar(255)) ENGINE=InnoDB;</pre>

<h3>ALTER TABLE</h3>
<p class="t">ALTER TABLE table_name <span>ADD</span> column_name datatype<br>
ALTER TABLE table_name <span>DROP COLUMN</span> column_name<br>
ALTER TABLE table_name <span>MODIFY COLUMN</span> column_name datatype<br>
ALTER TABLE table_name <span>CHANGE COLUMN</span> column_name new_column_name</p>

<h3>DROP TABLE</h3>
<p class="t">DROP TABLE table_name</p>

<h3>TRUNCATE TABLE</h3>
<p class="t">TRUNCATE TABLE table_name (deletes only the data inside the table)</p>

<h3>CREATE INDEX</h3>
<p class="t">CREATE [UNIQUE] INDEX index_name ON table_name (column_name)</p>
<pre>CREATE INDEX PIndex ON Persons (LastName, FirstName)</pre>

<h3>DROP INDEX</h3>
<p class="t"><span>MySQL:</span> ALTER TABLE table_name DROP INDEX index_name</p>

<h3>VIEW</h3>
<p class="t">CREATE VIEW view_name AS SELECT column_name(s) FROM table_name WHERE condition<br>
CREATE OR REPLACE VIEW view_name AS SELECT column_name(s) FROM table_name WHERE condition<br>
DROP VIEW view_name</p>
</div>

<div>
<h2>Constraints</h2>
<p class="t">NOT NULL, UNIQUE, PRIMARY, FOREIGN, CHECK, DEFAULT</p>

<h3>UNIQUE</h3>
<p class="t"><span>SQLServer / Oracle / Access:</span> CREATE TABLE Persons (P_Id int NOT NULL UNIQUE,...)</p>
<p class="t"><span>MySQL:</span> CREATE TABLE Persons(P_Id int NOT NULL,...,UNIQUE (P_Id))</p>
<pre>
ALTER TABLE Persons ADD UNIQUE (P_Id)
ALTER TABLE Persons ADD CONSTRAINT uc_PersonID UNIQUE (P_Id,LastName)
<span>SQLServer / Oracle / Access:</span> ALTER TABLE Persons DROP CONSTRAINT uc_PersonID
<span>MySQL:</span> ALTER TABLE Persons DROP INDEX uc_PersonID</pre>

<h3>PRIMARY KEY</h3>
<p class="t"><span>SQLServer / Oracle / Access:</span> CREATE TABLE Persons (P_Id int NOT NULL PRIMARY KEY,...)</p>
<p class="t"><span>MySQL:</span> CREATE TABLE Persons(P_Id int NOT NULL,...,PRIMARY KEY (P_Id))</p>

<p>ALTER TABLE Persons ADD PRIMARY KEY (P_Id)</p>
<p>ALTER TABLE Persons ADD CONSTRAINT pk_PersonID PRIMARY KEY (P_Id,LastName)</p>
<p><span>SQLServer / Oracle / Access:</span> ALTER TABLE Persons DROP CONSTRAINT pk_PersonID</p>
<p><span>MySQL:</span> ALTER TABLE Persons DROP PRIMARY KEY</p>

<h3>FOREIGN KEY</h3>
<p><span>MySQL:</span> CREATE TABLE Orders (...,FOREIGN KEY (P_Id) REFERENCES Persons(P_Id))</p>
<p>ALTER TABLE Orders ADD FOREIGN KEY (P_Id) REFERENCES Persons(P_Id)</p>
<p class="tip">To allow naming of a FOREIGN KEY constraint, and for defining constraint on multiple columns:</p>
<p>ALTER TABLE Orders ADD CONSTRAINT fk_PerOrders FOREIGN KEY (P_Id) REFERENCES Persons(P_Id)</p>
<p><span>MySQL:</span> ALTER TABLE Orders DROP FOREIGN KEY fk_PerOrders</p>

<h3>CHECK</h3>
<p><span>MySQL:</span> CREATE TABLE Persons (P_Id int NOT NULL,...,CHECK (P_Id>0))</p>
<p>ALTER TABLE Persons ADD CHECK (P_Id>0)</p>
<p>ALTER TABLE Persons ADD CONSTRAINT chk_Person CHECK (P_Id>0 AND City='Sandnes')</p>
<p><span>MySQL:</span> ALTER TABLE Persons DROP CHECK chk_Person</p>

<h3>DEFAULT</h3>
<p>CREATE TABLE Persons (...,City varchar(255) DEFAULT 'Sandnes')</p>
<p>CREATE TABLE Orders (...,OrderDate date DEFAULT GETDATE())</p>
<p><span>MySQL:</span> ALTER TABLE Persons ALTER City SET DEFAULT 'SANDNES'</p>
<p><span>MySQL:</span> ALTER TABLE Persons ALTER City DROP DEFAULT</p>

<h3>AUTO_INCREMENT</h3>
<p><span>MySQL:</span> CREATE TABLE Persons(ID int NOT NULL AUTO_INCREMENT,...)</p>
<p><span>MySQL:</span> ALTER TABLE Persons AUTO_INCREMENT=100</p>

<h3>NULL / NOT NULL</h3>
<p>SELECT LastName,FirstName,Address FROM Persons WHERE Address IS [NOT] NULL</p>
<p class="tip"><span>Note:</span> It is not possible to compare NULL and 0; they are not equivalent.</p>

<h3>NULL Functions</h3>
<p><span>MySQL:</span> SELECT ProductName,UnitPrice*(UnitsInStock+IFNULL(UnitsOnOrder,0)) FROM Products</p>

<h3>Dates</h3>
<p><span>MySQL:</span> NOW(), CURDATE(), CURTIME(), DATE(), EXTRACT(), DATE_ADD(), DATE_SUB(), DATEDIFF(), DATE_FORMAT()</p>

</div>

<div>

<h2>Aggregate Functions</h2>

<h3>AVG()</h3>
<p>SELECT AVG(column_name) FROM table_name</p>
<p>SELECT ProductName, Price FROM Products WHERE Price>(SELECT AVG(Price) FROM Products);</p>

<h3>COUNT()</h3>
<p><span>SELECT COUNT</span>(<span>(DISTINCT)</span> column_name) <span>FROM</span> table_name</p>
<p>SELECT COUNT(CustomerID) AS OrdersFromCustomerID7 FROM Orders WHERE CustomerID=7;</p>

<h3>FIRST() & LAST()</h3>
<p class="tip">The FIRST / LAST() function is only supported in MS Access, substitute method of MySQL:</p>
<p>SELECT column_name FROM table_name ORDER BY column_name DESC LIMIT 1;</p>		

<h3>MAX() & MIN()</h3>
<p>SELECT MAX(column_name) FROM table_name;</p>
<p>SELECT MAX(Price) AS HighestPrice FROM Products;</p>

<h3>SUM()</h3>
<p>SELECT SUM(column_name) FROM table_name;</p>
<p>SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;</p>
</div>

<div>

<h2>Scalar Functions</h2>

<h3>UCASE() & LCASE()</h3>
<p>SELECT UCASE(column_name) FROM table_name;</p>
<p><span>SQLServer: </span>SELECT UPPER(column_name) FROM table_name; // UPPER() /LOWER()</p>
<p>SELECT UCASE(CustomerName) AS Customer, City FROM Customers;</p>

<h3>MID()</h3>
<p>SELECT MID(column_name,start,[length]) AS some_name FROM table_name;</p>
<p><span>SQLServer: </span>SELECT SUBSTRING(column_name,start,length) AS some_name FROM table_name;</p>
<p>SELECT MID(City,1,4) AS ShortCity FROM Customers;</p>

<h3>LEN()</h3>
<p>SELECT LEN(column_name) FROM table_name;</p>
<p>SELECT CustomerName,LEN(Address) as LengthOfAddress FROM Customers;</p>

<h3>ROUND()</h3>
<p>SELECT ROUND(column_name,decimals) FROM table_name;</p>
<p class="tip">!! Many database systems round half to even, so make sure 0.5 to 0 or 1 ?</p>
<p>SELECT ProductName, ROUND(Price,0) AS RoundedPrice FROM Products;</p>

<h3>NOW()</h3>
<p>SELECT NOW() FROM table_name;</p>
<p>SELECT ProductName, Price, Now() AS PerDate FROM Products;</p>

<h3>FORMAT()</h3>
<p>SELECT FORMAT(column_name,format) FROM table_name;</p>
<p>SELECT ProductName, Price, FORMAT(Now(),'YYYY-MM-DD') AS PerDate FROM Products;</p>
</div>

</div>
</body>
</html>