<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/lib/html-main.css">
<script src="/lib/html-main.js"></script>
<title>MySQL 部署</title>
</head>
<body>
<div id="article">

<h1>Centos 下 MySQL 安装配置</h1>

<div>
<h2>MySQL安装及启动</h2>
<h3>安装</h3>
<pre># yum install mariadb-server mariadb  // MariaDB 数据库管理系统替代原 MySQL</pre>

<h3>配置编码</h3>
<pre>
[root@sample ~]# vi /etc/my.cnf　 ← 编辑MySQL的配置文件
[mysqld] default-character-set = utf8　// 设置默认编码 MySQL 用
[mysqld] character_set_server=utf8     // 设置默认编码 MariaDB 用
</pre>
<h3>忘记root密码解救方法</h3>
<pre>
[mysqld] skip-grant-tables  // /etc/my.cnf 下添加这个设置就可以直接登录，改密码后再注释掉这句
update mysql.user set password=password('newpassword') where user='root'
</pre>

<h3>启动服务</h3>
<pre><code>CentOS 7</code>
# systemctl start/stop/restart mariadb  // 启动/停止/重启 MariaDB
# systemctl enable mariadb   // 设置开机启动
# systemctl status mariadb   // 查看服务状态信息
</pre>
<pre><code>CentOS 6.5</code>
# chkconfig mysqld on　 ← 设置MySQL服务随系统启动自启动
# chkconfig --list mysqld　 ← 确认MySQL自启动
# /etc/rc.d/init.d/mysqld start　 ← 启动MySQL服务
</pre>
</div>

<div>
<h2>MySQL初始环境设定</h2>
<h3>[1]为MySQL的root用户设置密码，root用户默认是没有密码的。</h3>
<pre>
[root@sample ~]# mysql -u root　 ← 用root用户登录MySQL服务器
mysql> select user,host,password from mysql.user;　 ← 查看用户信息
mysql> set password for root@localhost=password('在这里填入root密码');　 ← 设置root密码
mysql> set password for root@'sample.centospub.com'=password('在这里填入root密码');　 ← 设置root密码
mysql> select user,host,password from mysql.user;　 ← 查看用户信息
mysql> exit　 ← 退出MySQL服务器
</pre>
<h3>[2] 删除匿名用户</h3>
<p>在MySQL刚刚被安装后，存在用户名、密码为空的用户。这使得数据库服务器有无需密码被登录的可能性。为消除隐患，将匿名用户删除。</p>

<pre>
mysql> select user,host from mysql.user;　 ← 查看用户信息
mysql> delete from mysql.user where user='';　 ← 删除匿名用户
</pre>

<h3>[3] 删除测试用数据库</h3>
<p>在MySQL被安装后，存在名为test的空数据库，将它删除。<br />这里要注意的是，系统默认的还有一个名为mysql的数据库，它用于系统管理，所以不能删除。</p>
<pre>
mysql> show databases;　 ← 查看系统已存在的数据库
mysql> drop database test;　 ← 删除名为test的空数据库
</pre>
</div>

<div>
<h2>测试MySQL</h2>
下面对MySQL进行测试。包括建立新用户，以及用对关系性数据库进行数据库操作的指令来试着建立数据库及数据表。这里，新建用户以centospub为例。
<pre>
mysql> grant all privileges on test.* to centospub@localhost identified by '密码';　 ← 建立对test数据库有完全操作权限的名为centospub的用户
mysql> select user from mysql.user where user='centospub';　 ← 确认centospub用户的存在与否
mysql> quit;

[root@sample ~]# mysql -u centospub -p　 ← 用新建立的centospub用户登录MySQL服务器
mysql> create database test;　 ← 建立名为test的数据库
mysql> show databases;　 ← 查看系统已存在的数据库

mysql> use test　 ← 连接到数据库
mysql> create table test(num int, name varchar(50));　 ← 在数据库中建立表
mysql> show tables;　 ← 查看数据库中已存在的表

mysql> insert into test values(1,'Hello World!');　 ← 插入一个值到表中
mysql> select * from test;　 ← 查看数据库中的表的信息

mysql> update test set name='Hello Everyone!';　 ← 更新表的信息，赋予新的值
mysql> select * from test;　 ← 查看数据库中的表的信息
mysql> delete from test where num=1;　 ← 删除表内的值
mysql> select * from test;　 ← 确认删除结果

mysql> drop table test;　 ← 删除表
mysql> show tables;　 ← 查看表信息

mysql> drop database test;　 ← 删除名为test的数据库
mysql> show databases;　 ← 查看已存在的数据库

mysql> exit　 ← 退出MySQL服务器

mysql> revoke all privileges on *.* from centospub@localhost;　 ← 取消centospub用户对数据库的操作权限
mysql> delete from mysql.user where user='centospub' and host='localhost';　 ← 删除centospub用户
mysql> select user from mysql.user where user='centospub';　 ← 查找用户centospub，确认已删除与否
mysql> exit　 ← 退出MySQL服务器

[root@sample ~]# /etc/rc.d/init.d/httpd restart　 ← 重新启动HTTP服务，让php-mysql反映到HTTP服务中。
</pre>
</div>

</div>
</body>
</html>