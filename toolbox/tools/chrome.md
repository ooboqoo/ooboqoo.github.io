# Chrome Developer Tool

https://developers.google.com/web/tools/chrome-devtools/


## 使用中碰到的问题

map 的 less 源文件时有时无，将 localhost 改为 127.0.0.1 后就正常显示，然后重置了设置，一切都好了。

还有就是关于 ts 文件 browserify 后设定 workspace 找不到源文件的问题，直接 map ts 源文件问题解决。2016/7/11


## Tips

https://www.youtube.com/watch?v=HF1luRD4Qmk Debugging The Web (Chrome Dev Summit 2016)

**行内添加多个断点** Use Inline Breakpoints for greater debugging granularity

**CSS快速跳转** Crtl+单击CSS样式快速跳转到源文件相应位置

### 控制台快速选择元素

**`$0` 指向选中 DOM**

**`$_` 指向控制台最后一个输出值**

### 更加智能的控制台

```js
// 智能识别 Enter 回车键盘
function fn() {    // 此处只输 `{` 并按下回车键，chrome 能够自动识别，不会立即执行
  console.log('')  // 此处会自动缩进
}                  // 输入 `}` 后再回车，chrome 会识别并执行此代码

// 智能提示
  console.l        // 输入过程中会给出智能提示
```

### 巧妙利用条件断点输出信息

原先代码中的 `console.log()` 可以移除，然后在 DevTool 中设置条件断点，而条件就是 `console.log()` 这样就可以在不污染代码的同时输出调试信息。

### 使用 Chrome 任务管理器

`Shift + Esc` 或 `更多工具 -> 任务管理器` 打开任务管理器。

### 打开 Shadow DOM 显示

`<vedio>` 等组件，可通过配置显示被隐藏的组件代码：Settings/General/Elements/Show user agent shadow DOM

### 改变颜色模式

`Shift + 单击颜色属性` 可在颜色模式 rgba hsl hexadecimal 之间来回切换。

### Workspace编辑本地文件

Workspace 把开发者工具变成了一个真正的 IDE。将 Sources 选项卡中的文件和本地项目中的文件进行匹配，直接编辑和保存，不必复制/粘贴到编辑器。

实现：Source左侧面板下右击 → Add Folder to worksapce

### 获取并调试监听器

```js
const listeners = getEventListeners($('button'))
debug(listeners.click[0].listener)
```

### 调试 Tooltips 或 Popover

如果是使用 CSS `:hover` 控制的，那很好调试，但如果是 js 控制的，就麻烦了，但办法总还是有的。

https://stackoverflow.com/questions/15370838/inspect-hovered-element-in-chrome
https://dev.to/phuchieu/how-debug-inspect-tooltip-2e5c

「Sources」面板 -》「Event Listener Breakpoints」-》「Mouse」-》「contextmenu」选上后，鼠标移到目标上，等出了气泡后点击右键，JS 就会停止执行，然后可以轻松使用 「Elements」面板调试了。


## 使工作区能保存修改  Set Up Persistence with DevTools Workspaces

https://developers.google.com/web/tools/setup/setup-workflow

Set up persistent authoring in Chrome DevTools so you can both see your
changes immediatedly and save those changes to disk.

Chrome DevTools lets you change elements and styles on a web page and see your
changes immediately. By default, refresh the browser and the changes go away
unless you’ve manually copied and pasted them to an external editor.

Workspaces lets you persist those changes to disk without having to leave
Chrome DevTools. Map resources served from a local web server to files on a
disk and view changes made to those files as if they were being served.

> Don't manually copy changes to local files. Use workspaces to persist changes made in DevTools to your local resources.   
> Stage your local files to your browser. Map files to URLs.   
> Once persistent workspaces are set-up, style changes made in the Elements panel are persisted automatically; DOM changes aren't. Persist element changes in the Sources panel instead.

### Add local source files to workspace

## Edit Sass, Less or Stylus

If you are using Sass, Less, Stylus or any other CSS preprocessor, editing the generated CSS output files in the Styles editor won’t help as they don’t map to your original source.

With CSS source maps, DevTools can automatically map the generated files to the original source files, which lets you live-edit these in the Sources panel and view the results without having to leave DevTools or refresh the page.

### The preprocessor workflow

When you inspect an element whose styles are provided by a generated CSS file, the Elements panel displays a link to the original source file, not the generated CSS file.

#### To jump to the source file:

Click the link to open the (editable) source file in the Sources panel.

`Ctrl + Click` on any CSS property name or value to open the source file and jump to the appropriate line.

When you save changes to a CSS preprocessor file in DevTools, the CSS preprocessor should re-generate the CSS files. Then DevTools then reloads the newly-generated CSS file.

### Enable/Disable CSS source maps & auto-reloading

CSS source maps are enabled by default. You can choose to enable automatic reloading of generated CSS files. To enable CSS source maps and CSS reload: Open DevTools Settings and click General. Turn on Enable CSS source maps and Auto-reload generated CSS.

### Requirements & Gotchas

Changes made in an external editor are not detected by DevTools until the Sources tab containing the associated source file regains focus. Manual editing of a CSS file generated by the Sass/LESS/other compiler will break the source map association until the page is reloaded. Using Workspaces? Make sure the generated CSS file is also mapped into the workspace. You can verify this by looking in Sources panel right-side tree, and seeing the CSS is served from your local folder. For DevTools to automatically reload styles when you change the source file, your preprocessor must be set up to regenerate CSS files whenever a source file changes. Otherwise, you must regenerate CSS files manually and reload the page to see your changes. You must be accessing your site or app from a web server (not a file:// URL), and the server must serve the CSS files as well as the source maps (.css.map) and source files (.scss, etc.). If you are not using the Workspaces feature, the web server must also supply the Last-Modified header.


## 如何建立文件映射

建立文件映射，就可以实时修改调试文件，并且可以立即保存修改到本地文件。

建立映射：Sources >> 右键点击相关文件并选择 Map to ...

映射管理：Settings >> Workspace >> Mappings


## 实时调试 Less 文件

chrome 设置：Setting/General/Sources/Enable CSS source maps/Auto-reload generated CSS

Less编译器设置：

CSS vs Less
  * CSS 原生支持，无需安装工具；可以直接用样式面板修改源码，实时保存；代码繁琐，可维护性差
  * Less 代码简洁，可维护性好；需要工具支持；不可用样式面板直接修改


## 前端调试工具 Chrome 使用分享

视频地址: http://edu.csdn.net/course/detail/1743/26849?auto_start=1

谷歌浏览器必会功能项目:
  1. 查看网站源码
  2. 查看HTML标签在页面中真正使用的CSS代码
  3. 格式化JS代码
  4. 断点调试JS代码
  5. 使用控制台编写测试代码
  6. 无缓存模式浏览页面
  7. 查看页面网络加载情况
  8. 使用仿真功能开发响应式页面,或手机APP页面
  9. 其他...


## 各个工具的简要介绍

### Element

Elements板块你可以看到整个页面的Dom结构。你可以在这里编辑HTML,查看元素CSS,查找元素等等。

### Network

这个板块，你可以查看页面所加载的所有资源响应情况，响应时间，浏览器等待时间，状态码，MINE Type,资源大小等。

### Sources

Sources就是所有资源了，你可以看到页面加载的资源，图片，css,js等，它们会按照资源的来源分类。

### Timeline

跟前面的工具相比，Timeline就高级很多了。它可以让你查看浏览器的渲染流程。解析代码,布局，绘制，合并渲染层。了解更多，查看之前的文章浏览器渲染流程

### Profiles

Profiles工具主要是用来检测CPU占用程度，堆栈申请的内存。

#### 找出 JavaScript 内存泄漏

https://blog.wilddog.com/?p=680  
https://developers.google.com/web/tools/chrome-devtools/memory-problems/?hl=zh-cn  
https://leeon.gitbooks.io/devtools/content/learn_basic/tips_and_tricks_part_profiles.html



### Resources

Resources工具显示资源的，跟Sources不同的是，它会对文档类型分类。并且它可以查看，增加，删除，修改页面LocalStorage，Session Storage,Cookies等等。

### Audits

Audits工具非常智能，它会告诉你如何优化页面，告诉你应该合并CSS,JS，应该明确图片的大小，以及某个css文件中unused CSS的百分比等。

### Console

Console应该都很熟悉了吧？经常会以为少写了’}’而报语法错误。当然它的功能远不止这些。点击这里查看更多


### Debugging

> 所有这里的功能，只是 Chrome DevTools 功能的一部分(仅针对 Chrome 调试)
> 部分参考视频 https://www.youtube.com/watch?v=-q1z8BPFItw

#### Breakpoints

Breakpoints can be toggled by clicking on the editor margin.
Finer breakpoint control (enable/disable/reapply) can be done in the Debug view's BREAKPOINTS section.

#### Conditional Breakpoints

条件断点：先正常设置断点，然后在断点上右击 -> 编辑断点 就可以设置条件断点了。条件断点目前支持 ‘表达式’ 和 ‘命中次数’ 两种方式。

#### Function Breakpoints

Instead of placing breakpoints directly in source code, a debugger can support creating breakpoints by specifying a function name.

#### Data inspection

Variables can be inspected in the VARIABLES section of the Debug view or by hovering over their source in the editor.

Variables and expression evaluation is relative to the selected stack frame in the CALL STACK section.

Variables and expressions can also be evaluated and watched in the Debug view WATCH section.

#### Using Console - Chrome

console.log() / console.clear()  
console.assert(expression, object)  
console.table()  
同时输入多行命令：`Shift + Enter`
使用代码片段：`Sources -> Snippets` 右击某条 snippet 选 run 即可执行  
实时编辑：通过开发工具，我们可以实时改变样式，DOM 结构，另外，在调试断点处暂停时，还可以通过在控制台输入命令，**变更代码运行环境**(就是在断点处可以实时插入调试代码，如改变变量值啥的)。

#### Debug actions

* Continue: continues code execution until we encounter another breakpoint
* Step Over: step through code line-by-line to get insights into how each line affects the variables being updated. Should your code call another function, the debugger won't jump into its code, instead stepping over so that the focus remains on the current function(scope).
* Step Into: like Step Over, however clicking Step into at the function call will cause the debugger to move its execution to the first line in the functions definition.
* Step Out: having stepped into a function, clicking this will cause the remainder of the funciton definiton to be run and the debugger will move its execution to the parent function.

#### `debugger` 关键字

The debugger keyword stops the execution of JavaScript, and calls (if available) the debugging function.

This has the same function as setting a breakpoint in the debugger.

If no debugging is available, the debugger statement has no effect.

使用 debugger 关键字设置断点，效果同在调试器中设置断点。如果调试器处于打开状态，代码运行到 `debugger;` 时会中断，如果没开调试器，则会被忽略。

> 2016/11/8 调试时，碰到断点代码与实际代码错位的问题，ts 转 js 然后又 webpack 结果调试时差了 4行(这次问题出在 webpack 配置 devtool: 'eval-cheap-module-source-map' 改 'source-map' 后运行正常，估计是 angular2 templateUrl 导致的问题)，这问题很坑，调试器整个都不能正常工作，使用 debugger 可以快速发现到底有没有错行，或者是错了几行。
> 
> 错行导致的另外一个问题是，代码旁边的变量计算结果备注，或者是当鼠标移动到代码上时的显示结果，会出现偏差。具体情况是，结果是根据实际代码执行情况实时计算的(跟此时在 console 里输入变量的返回结果是一样的)，而代码定位器与实际代码执行进度不同，结果会出现怪异的结果：
> ```ts
> let a = 1;  // 计算结果 a = undefined, 这与代码表面期望结果不符，令人费解
> // some other code, 调试器指针处于这一行，而实际运行连上一行都还没执行
> ```

