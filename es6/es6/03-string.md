# 字符串与正则表达式

ES6加强了对Unicode的支持，并且扩展了字符串对象。

##### codePointAt()

codePointAt方法会正确返回32位的UTF-16字符的码点。对于那些两个字节储存的常规字符，它的返回结果与charCodeAt方法相同。

##### String.fromCodePoint()

ES6提供了String.fromCodePoint方法，可以识别0xFFFF的字符，弥补了String.fromCharCode方法的不足。

##### 字符串的遍历器接口

ES6为字符串添加了遍历器接口，使得字符串可以被for...of循环遍历。

##### includes(), startsWith(), endsWith()

传统上，JavaScript只有indexOf方法，可以用来确定一个字符串是否包含在另一个字符串中。ES6又提供了三种新方法。

includes()：返回布尔值，表示是否找到了参数字符串。  
startsWith()：返回布尔值，表示参数字符串是否在源字符串的头部。  
endsWith()：返回布尔值，表示参数字符串是否在源字符串的尾部。

##### repeat()

repeat方法返回一个新字符串，表示将原字符串重复n次。

##### padStart()，padEnd()

ES7推出了字符串补全长度的功能。如果某个字符串不够指定长度，会在头部或尾部补全。padStart用于头部补全，padEnd用于尾部补全。

## 模板字符串

模板字符串（template string）是增强版的字符串，用反引号（`）标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量。

在 ES6 之前 JS 并不支持多行字符串，虽然有一些变通的方法可以实现。
如果使用模板字符串表示多行字符串，所有的空格和缩进都会被保留在输出之中。

如果在模板字符串中需要使用反引号，则前面要用反斜杠转义。

模板字符串中嵌入变量，需要将变量名写在${}之中。
大括号内部可以放入任意的JavaScript表达式，可以进行运算，以及引用对象属性。

## 标签模板

通过模板字符串可以创建多行字符串，可以插入变量，但模板字符串真正强大的地方在于标签模板。

模板字符串可以紧跟在一个标签后面，该标签其实就是一个函数名，该函数将被调用来处理这个模板字符串。这被称为“标签模板”功能（tagged template）。

标签模板其实不是模板，而是函数调用的一种特殊形式。“标签”指的就是函数，紧跟在后面的模板字符串就是它的参数。

```js
var a = 5;
var b = 10;

tag`Hello ${ a + b } world ${ a * b }`;
// 等同于
tag(['Hello ', ' world ', ''], 15, 50);
```

`tag`函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分。   
`tag`函数的其他参数，都是模板字符串各个变量被替换后的值。

`tag`函数所有参数的实际值如下。

- 第一个参数：`['Hello ', ' world ', '']`
- 第二个参数: 15
- 第三个参数：50

也就是说，`tag`函数实际上以下面的形式调用。

```js
tag(['Hello ', ' world ', ''], 15, 50)
```

我们可以按照需要编写`tag`函数的代码。下面是`tag`函数的一种写法，以及运行结果。

```js
var a = 5;
var b = 10;
function tag(s, v1, v2) {
  return s[0] + v1 + s[1] + v2 + s[2] ;
}
tag`Hello ${ a + b } world ${ a * b}`;  // "Hello 15 world 50"
```

### 标签模板的应用

“标签模板”的一个重要应用，就是过滤HTML字符串，防止用户输入恶意内容。

标签模板的另一个应用，就是多语言转换（国际化处理）。

模板字符串本身并不能取代 Mustache 之类的模板库，因为没有条件判断和循环处理功能，但是通过标签函数，你可以自己添加这些功能。

除此之外，你甚至可以使用标签模板，在 JavaScript 语言之中嵌入其他语言。

```javascript
// 下面的hashTemplate函数是一个自定义的模板处理函数
var libraryHtml = hashTemplate`
  <ul>
    #for book in ${myBooks}
      <li><i>#{book.title}</i> by #{book.author}</li>
    #end
  </ul>
`;
```

### String.raw()
String.raw方法，往往用来充当模板字符串的处理函数，返回一个斜杠都被转义（即斜杠前面再加一个斜杠）的字符串，对应于替换变量后的模板字符串。











