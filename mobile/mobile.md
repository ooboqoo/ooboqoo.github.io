# 移动端开发概览

## 移动 Web 与 HTML5

* 语义化 - 赋予网页更好的意义和结构
* 本地存储 - 更短的启动时间，甚至离线使用
* 设备兼容 - 提供了非常丰富的 API，便于优化
* 连接特性 - SSE 和 WebSocket 使得连接工作效率更高，特别是在实时聊天和网页游戏方面，大大提高了用户体验
* 多媒体 - 网页标签自身支持音视频的播放，打破了对 Flash 的依赖，提升了开发效率和用户体验
* 图形特效 - 提供了 Canvas WebGL 等图形和三维功能，使普通网页也能呈现出惊人效果

移动端开发和 PC 端开发有着很大差别，相当一部分 HTML5 特性在移动设备上能有更大的施展空间。

* 视口控制 Viewport
* 媒体查询 @media
* 音视频播放 Audio/Video


## 移动 Web 与原生应用的优劣势比较

移动 Web 的优势
* 跨平台 - 只依赖浏览器，与平台无关
* 开发成本低 - 只要一个开发团队即可应对多个平台
* 更容易迭代 - 不需要用户主动安装更新就可以实现产品的升级迭代

移动 Web 的劣势
* 功能有限 - 很多硬件设备独特功能无法使用
* 操作体验欠佳 - 用户的操作并非由系统直接接收并响应，加上浏览器质量参差不齐，操作体验势必有所下降
* 无法离线使用 - 即使提供了离线功能，首次访问时还是要在线下载
* 很难被发现 - Web APP 不具备在商店展示的条件

原生应用的优势
* 功能完善 - 几乎具备设备所有功能的访问权限，可以满足用户的各种需求
* 体验更好 - 速度更快，性能高
* 可离线使用 - 所有程序代码和静态资源都在安装时已经就位
* 发现机会高 - 无论是第一次下载(从应用商店)，还是再一次使用(从图标打开)，原生应用的机会都远大于 Web 应用

原生应用的劣势
* 开发成本高 - 每个系统都需要维护一套代码，开发和维护成本都高
* 迭代不可控 - 首先更新上线需要应用商店的审核，其次用户何时升级也是完全不受控制的
* 内容限制 - 各应用商店都有自己的规范条例

鉴于 Web 应用和原生应用各自的优劣势，已经有越来越多的 APP 开始走向混合开发的模式，即原生和 Web 同时存在。*原生部分为用户提供更好的使用体验，Web 部分可以实现更为快速的迭代更新*。

## 移动 Web 开发技能树

```txt
浏览器
  |- 浏览器兼容
  |- HTTP协议
  |- 性能，如资源加载性能、页面渲染性能
  \- 安全，如 XSS CSRF

库/框架
  |- JavaScript库：jQueryMobile Zepto
  |- UI库：BootStrap
  |- 渲染模板
  |- MVVM框架：React Vue.js Angular
  |- 数据可视化 D3 ECharts
  \- Node.js

工程化
  |- 模块化标准 AMD CMD CommonJS UMD
  |- 包管理器 NPM Yarn
  |- 构建工具 Gulp Webpack Rollup
  \- CI/CD

移动前沿技术
  |- Hybrid Cordova
  |- ReactNative Weex
  |- 微信小程序
  \- PWA 快应用
```

## 技术拐点与未来趋势

* 2005年前，网页比较简陋，没有太多交互。后端工程师使用后端模板完成页面渲染，使用的是后端 Web 框架。
* 2005年，谷歌开始大量使用 AJAX 技术
* 2012年，Hybrid 技术开始被大规模使用。

随着智能手机的普及，PC 业务慢慢向移动端转移，移动端 APP 开始大面积兴起，业务版本的快速迭代，也使得原生移动的开发方式的缺点暴露得越来越明显。为了解决这些问题，2012年，Hybrid 技术开始被大规模使用。为了让 Hybrid APP 能够接近 Native APP 的视觉和交互体验，对 Web 开发者的能力要求也达到了一个新的高度。

看完 Web 前端的前世今生，可以发现，Web 前端的定位是希望能够扩展到所有的跟 *表现层* 相关的领域，*解决人机交互的问题*。


## 混合式开发

### 混合式开发种类

#### WebView 模式

WebView 模式的代表是 PhoneGap 和 Cordova，App 原生部分仅仅作为一个容器，主要的业务代码都在 WebView 中实现。

#### JavaScriptCore 模式

除了传统的基于 WebView 的混合应用，JavaScriptCore 带来了一种全新的开发模式，即通过 JavaScript 调用原生代码渲染原生控件的混合式开发。

JavaScriptCore 框架最早出现在 WebView 的 Webkit 内核中，iOS7 开放了这一能力，之后 Android 也提供了类似的功能。进而催生了 ReactNative 这样的使用 JavaScript 作为 Bridge 操作原生代码来构建应用的方案，整个应用可以被理解为原生应用。

#### 微信小程序

微信小程序本质仍使用了 WebView 方案，但独立设计了一套语法对应传统的 HTML CSS JS，限制了一些可能导致问题的语法，在部分组件上也学习了 ReactNative 类框架，直接渲染原生组件来提升性能，再利用离线缓存获得流畅体验。这种方案依赖应用的内部设计，并非一个通用的解决方案。

### 混合式开发的优势

混合式开发存在着几个显著的优势让其能够被各大厂商迅速接受，主要的优点有以下三个。
  * 跨平台 - 各平台都使用 HTML+CSS+JS 开发，入门门槛低，能有效减少开发人力成本
  * 快速发布 - Web 代码无须编译，目前也是各大主流平台允许的热更新方案，所以对于应用来说，*一些活动或者经常发生功能或UI变动的页面是采用混合式开发的合理场景*
  * 功能提升 - 如果说只需要前两个优点，WebView 加载页面就能够很好的处理，然而混合式开发还需要原生端的支持。一方面 Web 端在 API 能力上有限制，无法充分利用原生端的资源，而混合式开发可以将这些能力暴露给 Web 端调用。混合式开发的意义同样也在于获得原生端的优势，让用户能够拥有更好的体验。

### 选择合适的混合式开发方案

选择一个合适的方案需要综合三点：开发效率、用户体验和项目复杂度。

如果开发者已经有了现成的应用并且有一定的原生代码开发能力，只是需要让 Web 页面嵌入 APP 中实现一些动态展示，可以选择自行实现一套 WebView 扩展方案。这种方案轻量且对现有应用影响很小。

如果内嵌 H5 页面比较复杂或者是需要构建一个完整的 APP，且开发者更专长于 Web 技术，适合 PhoneGap 或 Cordova 这类的方案。其中 Cordova 提供了强大的插件系统，开发者可以在不熟悉原生代码的前提下快速获得原生应用的能力。需要注意的是，在某些场景下(如动画)，WebView 的表现并不流畅，通过这种方案构建的完整应用 *体验较差*。

另一方面，开发者需要注意到 WebView 在 Android 系统中存在碎片化，即会出现机型表现差异性，可以引入 Crosswalk 插件替代来保证功能或样子的一致性。在 iOS 也可以引入 WKWebView 来提升整体的性能、稳定性和丰富功能。不过，引入一个新的 WebView 会增大自身 APP 的体积，需要开发者权衡利弊。

对于 ReactNative 或 Weex 这类技术，既可以实现完整的应用也可以嵌入 APP 作为其中的一部分。这类技术能够提供接近原生应用的体验，但是也存在一些问题，主要体现在：一方面会存在一些平台兼容问题，另一方面 JS 和原生代码设计到多线程的异步通信模型，造成部分效率损耗，另外，因为整个运行过程对原生代码依赖较重，出现问题较难排查。此类技术是目前混合式开发的主流前进方向，开发者应当在保持一定技术敏感的前提下，学习并视情况使用。
