# 设计原则和思想：面向对象


## 面向对象的一些概念和知识点


**面向对象编程** 是一种编程范式或编程风格。它以类或对象作为组织代码的基本单元，并将封装、抽象、继承、多态四个特性，作为代码设计和实现的基石。

**面向对象编程语言** 是支持类或对象的语法机制，并有现成的语法机制，能方便地实现面向对象编程四大特性的编程语言。

如何判定一个编程语言是否是面向对象编程语言？如果按照严格定义，需要有现成的语法支持类、对象、四大特性才能叫作面向对象编程语言。如果放宽要求的话，只要某种编程语言支持类、对象语法机制，那基本上就可以说这种编程语言是面向对象编程语言了，不一定非得要求具有所有的四大特性。

面向对象编程和面向对象编程语言之间有何关系？面向对象编程一般使用面向对象编程语言来进行，但是，不用面向对象编程语言，我们照样可以进行面向对象编程。反过来讲，即使我们使用面向对象编程语言，写出来的代码也不一定是面向对象风格的，也有可能是面向过程编程风格的。

什么是面向对象分析和面向对象设计？简单点讲，**面向对象分析** 就是要搞清楚做什么，**面向对象设计** 就是要搞清楚怎么做。两个阶段最终的产出是类的设计，包括程序被拆解为哪些类，每个类有哪些属性方法、类与类之间如何交互等等。


## 面向对象的四大特性

学习每一种特性，我们都可以从 What How Why 三个角度去分析。  
学习每一种特性的意义时，我们都可以从维护者和使用者这两个角度去分析其作用。

### 封装 Encapsulation

*封装也叫信息隐藏或数据访问保护*。类 *通过暴露有限的访问接口*，授权外部仅能通过类提供的方式来访问内部信息或者数据。它需要编程语言提供权限访问控制语法来支持，例如 Java 中的 `private` `protected` `public` 关键字。封装特性存在的意义，一方面是 *保护数据不被随意修改，提高代码的可维护性*；另一方面是 *仅暴露有限的必要接口，提高类的易用性*。

### 抽象 Abstraction

封装主要讲如何隐藏信息、保护数据，那抽象就是讲 *如何隐藏方法的具体实现*，让使用者只需要关心方法提供了哪些功能，不需要知道这些功能是如何实现的。*抽象可以通过接口类或抽象类来实现*。抽象存在的意义，一方面是提高代码的可扩展性、维护性，*修改实现不需要改变定义*，减少代码的改动范围；另一方面，它也是处理复杂系统的有效手段，*能有效地过滤掉不必要关注的信息*。

### 继承 Inheritance

继承用来表示类之间的 `is-a` 关系，分为两种模式：单继承和多继承。单继承表示一个子类只继承一个父类，多继承表示一个子类可以继承多个父类。为了实现继承的这个特性，编程语言需要提供特殊的语法机制来支持。*继承主要用来解决代码复用的问题*。

### 多态 Polymorphism

多态是指子类可以替换父类，在运行时调用子类的方法实现。多态这种特性也需要编程语言提供特殊的语法机制来实现，不如继承、接口类、duck-typing。*多态可以提高代码的可扩展性和复用性，是很多设计模式、设计原则、编程技巧的代码实现基础*。比如策略模式、基于接口而非实现编程、依赖倒置原则、里式替换原则、利用多态去掉冗长的 if-else 语句等等。



## 组合 VS 继承

*通过 组合、接口、委托 三个技术手段替换复杂的继承关系*

继承最大的问题就在于：继承层次过深、继承关系过于复杂会影响到代码的可读性和可维护性。

实际上，我们可以利用组合(compositon)、接口、委托(delegation)三个技术手段，一块儿来解决刚刚继承存在的问题。我们知道继承主要有三个作用：表示 is-a 关系，支持多态特性，代码复用。而这三个作用都可以通过其他技术手段来达成。比如 is-a 关系，我们可以通过组合和接口的 has-a 关系来替代；多态特性我们可以利用接口来实现；代码复用我们可以通过组合和委托来实现。所以，从理论上讲，通过组合、接口、委托三个技术手段，我们完全可以替换掉继承，在项目中不用或者少用继承关系，特别是一些复杂的继承关系。

```java
public interface Flyable {
  void fly()；
}
public class FlyAbility implements Flyable {
  @Override
  public void fly() { //... }
}

//省略Tweetable/TweetAbility/EggLayable/EggLayAbility

public class Ostrich implements Tweetable, EggLayable {//鸵鸟
  private TweetAbility tweetAbility = new TweetAbility(); //组合
  private EggLayAbility eggLayAbility = new EggLayAbility(); //组合
  //... 省略其他属性和方法...
  @Override
  public void tweet() {
    tweetAbility.tweet(); // 委托
  }
  @Override
  public void layEgg() {
    eggLayAbility.layEgg(); // 委托
  }
}
```

尽管我们鼓励多用组合少用继承，但组合也并不是完美的，继承也并非一无是处。从上面的例子来看，继承改写成组合意味着要做更细粒度的类的拆分。我们要定义更多的类和接口。类和接口的增多也就或多或少的增加代码的复杂程度和维护成本。所以，在实际的项目开发中，我们还是要根据具体的情况来进行选择。

如果类之间的继承结构稳定(不会轻易改变)，继承层次比较浅，继承关系不复杂，我们就可以大胆地使用继承。反之，系统越不稳定，继承层次很深，继承关系复杂，我们就尽量使用组合来替代继承。

除此之外，还有一些设计模式会固定使用继承或者组合。如，装饰者模式（decorator pattern）、策略模式（strategy pattern）、组合模式（composite pattern）等都使用了组合关系，而模板模式（template pattern）使用了继承关系。

利用继承特性，我们把相同的属性和方法，抽取出来，定义到父类中。子类复用父类中的属性和方法，达到代码复用的目的。但是，有的时候，从业务含义上，A 类和 B 类并不一定具有继承关系。比如，Crawler 类和 PageAnalyzer 类，它们都用到了 URL 拼接和分割的功能，但并不具有继承关系（既不是父子关系，也不是兄弟关系）。仅仅为了代码复用，生硬地抽象出一个父类出来，会影响到代码的可读性。如果不熟悉背后设计思路的同事，发现 Crawler 类和 PageAnalyzer 类继承同一个父类，而父类中定义的却只是 URL 相关的操作，会觉得这个代码写得莫名其妙，理解不了。这个时候，使用组合就更加合理、更加灵活。

### 为什么不推荐继承

继承是面向对象的四大特性之一，可以解决代码复用的问题。虽然继承有诸多作用，但继承层次过深、过复杂，也会影响到代码的可维护性。在这种情况下，我们应该尽量少用甚至不用继承。

### 组合相比继承有哪些优势

继承主要有三个作用：表示 is-a 关系，支持多态特性，代码复用。而这三个作用都可以通过组合、接口、委托三个技术手段来达成。利用组合能解决层次过深、过复杂的继承关系影响代码可维护性的问题。

### 如何判断该用组合还是继承

尽管我们鼓励多用组合少用继承，但组合也并不是完美的，继承也并非一无是处。在实际的项目开发中，我们还是要根据具体的情况，来选择该用继承还是组合。如果类之间的继承结构稳定，层次比较浅，关系不复杂，我们就可以大胆地使用继承。反之，我们就尽量使用组合来替代继承。除此之外，还有一些设计模式、特殊的应用场景，会固定使用继承或者组合。


