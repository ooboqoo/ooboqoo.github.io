# 数据库综述



## 数据库的演化

### 数据库的由来

要保存用户的数据，最简单的方法是把用户数据写入文件，如 CSV 文件。但随着应用程序的功能越来越复杂，数据量越来越大，如何管理这些数据就成了大问题：读写文件并解析出数据需要大量重复代码；从成千上万的数据中快速查询出指定数据需要复杂的逻辑。如果每个应用程序都各自写自己的读写数据的代码，一方面效率低，容易出错，另一方面，每个应用程序访问数据的接口都不同，数据难以复用。

所以，数据库作为一种专门管理数据的软件就出现了。应用程序不需要自己管理数据，而是通过数据库软件提供的接口来读写数据。这样一来，编写应用程序的时候，数据读写的功能就被大大地简化了。

### 数据模型

数据库按照数据结构来组织、存储和管理数据，实际上，数据库一共有三种模型：层次模型、网状模型、关系模型。关系模型把数据看作是一个二维表格，任何数据都可以通过行号+列号来唯一确定，看起来就像一个 Excel 表格。随着时间的推移和市场竞争，最终，基于关系模型的关系数据库获得了绝对市场份额。

### RDB

关系模型数据库做出了一个革命性的变革：*用 逻辑结构(logical representation of data) 代替 物理结构(physical representation of data)*。表格无异于一个数组，数组查询是很慢的。真实的物理结构，是复杂的数据结构。程序猿们不需要直接和物理结构打交道，只负责告诉数据库，他想做什么，至于数据是如何存储、如何索引，都交给数据库。

### RDB 的不足

在 RDB 被发明的时代，人们对数据的要求非常纯粹：准确、可靠、安全，让数据按照期望正确写入。于是有了具有 ACID 特性的事务：原子性、一致性、隔离性和持久性。那时，数据库的数据量和访问量都没法和现在比，一台机器足矣，最多再来个一主多从。后来，随着数据量的爆炸，就有了分布式，有了 BASE 和 CAP。

在分布式场景下，RDB 之前的那一套 ACID 竟然有点作茧自缚了：为了保证事物的隔离性，要进行加锁，在分布式环境下就要对多台机器的数据进行加锁；为了保证事务的原子性，多台机器上的操作要么一起成功要么一起失败；... 这些都需要不同节点的机器进行通讯和协调，实现起来非常复杂，影响性能。而 NoSQL 则没有这么多承诺，它的一致性一般都是最终一致性，当然你也可以选择强一致性，就看你在安全和性能之间如何取舍了。

除此之外，RDB 的 数据库范式(Database Schema) 也成了限制扩展性的瓶颈。为了避免数据冗余导致的各种问题(如占用空间、删除异常、更新异常等)，我们设计关系模型时通常都是按照最小单位来设计的，即一组信息会被拆分保存到多张表中。如果这些表被分散在不同的机器，那么进行关联查询时，就需要多次跨机器的通讯。而对于 NoSQL，这一组信息可以以 JSON 的形式存放在一起。NoSQL 比 RDB 有更强的扩展性，可以充分利用分布式系统来提升读写性能和可靠性。

总结下：*SQL 首先确保准确、可靠，然后向更高的可拓展性发展；NoSQL 生而分布式，可拓展性强，然后才向更高的准确性发展*。

### NoSQL 分类

NoSQL (not only SQL) 其实就是对那种打破了 RDB 严格事务和关系模型约束的那些数据库的泛指，而随着要解决问题的不同，又诞生了各种 NoSQL。



## 关系型数据库

目前主流的关系型数据库主要有以下几类：
* 商用数据库，如 Oracle、SQL Server、DB2 等
* 开源数据库，如 MySQL、PostgreSQL 等
* 桌面数据库，以 Access 为代表，适合桌面应用程序
* 嵌入式数据库，以 Sqlite 为代表，适合手机应用和桌面程序


## SQL

SQL 是结构化查询语言的缩写，用来访问和操作数据库系统。SQL 语句既可以查询数据，也可以添加、更新和删除数据，还可以对数据库进行管理和维护操作。总的来说，SQL 语言定义了这么几种操作数据库的能力。

* DDL (Data Definition Language) 允许用户定义数据，即建表、删表、修改表结构。DDL 通常由 DBA 执行。
* DML (Data Manipulation Language) 为用户提供添加、删除、更新数据的能力。
* DQL (Data Query Language) 允许用户查询数据。



