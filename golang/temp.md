# 临时记录


## 学习资料

* Official Web  https://go.dev
* Wiki https://github.com/golang/go/wiki
* 入门书籍 [Go语言圣经](http://books.studygolang.com/gopl-zh/) （项目地址：https://github.com/golang-china/gopl-zh ）
* 进阶书籍 [Go语言高级编程](https://chai2010.cn/advanced-go-programming-book/)
* 进阶书籍 [Go语言设计与实现](https://draveness.me/golang/)
* Learning by examples https://gobyexample.com/



## 左耳听风

Go 语言三位创始人之一 Rob Pike 在 Go: Ten years and climbing 中说：Go 语言这十年的迅猛发展连他自己都没有想到，并且还成为了云计算领域新一代的开发语言。


Go 语言和 Docker 这两种技术已经成为新一代的云计算技术。

我对 Go 语言有如下几点体会：

* 语言简单，上手快。Go语言的语法特性简直是太简单了，简单到你几乎玩不出什么花招。直来直去，*学习难度很低*。
* 并行和异步编程几乎无痛点。Routine 和 Channel 这两个神器简直就是并发和异步编程的巨大福音。
* Go 语言的 lib 库 “麻雀虽小，五脏俱全”。
* C 语言的理念和 Python 的姿态。C 语言的理念是信任程序员，保持语言的小巧，不屏蔽底层且对底层友好，关注语言的执行效率和性能。而 Python 的姿态是用尽量少的代码完成尽可能多的事。Go 想要把 C 和 Python 统一起来，这是多棒的一件事。

即便 Go 语言存在诸多的问题，比如垃圾回收、异常处理、泛型编程等，但相较于上面这几个优势，我认为这些问题都是些小问题。

当然，一个技术能不能发展起来，关键还要看三点：

* 有没有一个比较好的社区
* 有没有一个工业化的标准
* 有没有一个或多个杀手级应用

除了上面这三点重要的，还有一些其他的影响因素，比如

* 学习难度是否低，上手是否快。这点非常重要，C++ 在这点上越做越不好了
* 有没有一个不错的提高开发效率的开发框架。如，Java 的 Spring 框架，C++ 的 STL 等
* 是否有一个或多个巨型的技术公司作为后盾
* 有没有解决软件开发中的痛点。如，Java 解决了 C 和 C++ 的内存管理问题

用这些标尺来衡量一下 Go 语言

* Go 语言容易上手
* Go 语言解决了并发编程和底层应用开发效率的痛点
* Go 语言有谷歌这个世界一流的技术公司在后面
* Go 语言的杀手级应用是 Docker 容器

我个人觉得，Go 可能会吞食很多 C++、Java 的项目。不过，*Go 语言所吞食的项目应该主要是中间层的项目，既不是非常底层也不会是业务层*。也就是说，Go 语言不会吞食底层到 C 和 C++ 那个级别，也不会吞食到上层如 Java 业务层的项目。Go 语言能吞食的一定是 PaaS 上的项目，比如一些消息缓存中间件、服务发现、服务代理、控制系统、Agent、日志收集等等，它们没有复杂的业务场景，也到不了特别底层（如操作系统）的软件项目或工具。而 C 和 C++ 会被打到更底层，Java 会被打到更上层的业务层。

早在三四年前我就觉得 Docker 一定会是未来的技术。同样，Kubernetes 作为服务和容器调度的关键技术一定会是最后的赢家。

如果一个公司或是个人能够占有技术先机，就会比其他公司或个人有更大的影响力。一旦未来行业需求引爆，那么这个公司或是个人的影响力就会形成一个比较大的护城河，并可以快速地从中获取经济利益。




## 初识 GO

Go是云计算时代基础设施领域、云服务领域最具竞争力的编程语言。

如果你是一名前端开发人员，相比于 Java 这样的老牌语言，它不仅简单，上手快，而且在并行和异步编程方面几乎无痛点，能很快建立起学习自信。Go 虽然入门简单，但进阶却不是件容易的事。
* 大规模使用 Go 进行业务开发时，因为 Go 没有 Java 成熟统一的框架，给统一的项目标准化带来了挑战
* Go 在语言层面提供了并发协程的机制，如果你不了解其中的机制，仅仅按照线程的套路来使用，就发挥不出来协程的优势，甚至还会导致很多性能问题
* 在搭建流行的微服务架构，解决效率、可用性、一致性等问题时，也还有不少坑要踩


特点
  * 运行效率高，开发高效，部署简单。
  * 语言层面支持并发，易于利用多核实现并发
  * 内置 runtime(作用: 性能监控 GC 等)
  * 简单易学，丰富的标准库，强大的网络库
  * 内置强大的工具 (gofmt)，跨平台编译，内嵌 C 支持

应用领域
  * 服务器编程，如处理日志、数据打包、虚拟机处理、文件系统等
  * 分布式系统，数据库代理，中间件等
  * 网络编程，目前使用最多最广泛的一块，Web应用、API应用等
  * 云平台，目前云平台逐步采用 GO 实现




## 待整理内容

关于环境变量

```bash
$ export V2RAY_VMESS_AEAD_FORCED=false  # 要是不带 `export` go 代码读不到这个环境变量
```

【问】刚刚发现一个想不通的问题，xxx  
【答】该不会线上版本不对吧...

【问】排查线上 Panic
【答】grep panic -B 5 -A 20 /opt/tiger/toutiao/log/run/${PSM}.run.log.*

【问】怎么获取多层嵌套指针结构体下的字段比较好呢，比如thrift生成的都是optional，获取时中间一个空指针就panic了，每层都判断好麻烦  
【答】要是能自己控制thriftgo生成选项，加一个nil_safe就能无脑用getter
【答】KiteX 通过 `--thrift nil_safe` 配置


【问】有没有遇到过RPC请求里面 Base.Extra 被重置成默认值的情况
【答】已经找到原因了，metainfo 不支持非字符串的 value，也不报错，直接就丢弃了



### CPU 利用率

Rust 相比Go，不仅仅是CPU、MEM 有提升，SLA 也有明显提升，能解决尖刺问题，降低 P99。

同时，Rust 服务CPU利用率极限情况下可以用满 （90%）而不带来稳定性（尖刺）问题，对比 Go 基本最高可用至 65% 无法继续提升 （否则服务可用性急剧下降），相当于可以多利用很多 CPU 资源。当然，出于容灾考虑，*Rust 服务 CPU 利用率不高于 50%, Go 不高于 30%*

### ElasticSearch

分词搜索





