# 软件建模与软件设计文档

软件设计就是在软件开发之前，对 *要解决的业务问题* 和 *要实现的软件系统* 进行思考，并将思考结果 *通过软件模型表达出来* 的过程。

软件开发管理与技术架构的核心诉求：
* 如何开展软件架构设计工作？
* 如何输出工作成果？
* 如何确定设计是否满足用户需求？
* 如何确保最后交付的软件满足用户需求？
* 如何让工程师清楚自己的职责范围并有效地完成开发工作？

软件架构设计的主要 *手段* 就是 *软件建模*，以及将这些软件模型组织成一篇有价值的 *软件设计文档*。


## 软件建模

https://time.geekbang.org/column/article/486761

软件开发中有两个客观存在
* 要解决的领域问题：对客观领域问题的抽象就是各种 *功能* 及其关系、各种 *模型* 对象及其关系、各种业务处理 *流程*
* 最终开发出来的软件系统
  - 有哪些主要 *类* 组成
  - 这些类如何组织成一个个的 *组件*
  - 这些类和组件之间的 *依赖关系* 如何
  - 运行期如何 *调用*
  - 需要 *部署* 多少台服务器
  - 服务器之间如何 *通信*
  - etc.

对领域问题和软件系统进行分析、设计和抽象的这个过程，就是软件建模设计。

```txt
领域问题 --(分析、抽象)--> 模型 ---(设计、抽象)--> 软件系统
                             <--(开发、实现)---
```

软件设计其实就是软件建模的过程，我们通过软件建模工具，将软件模型画出来，实现软件设计。

在实践中，通常用来进行软件建模画图的工具是 统一建模语言（UML）。UML 包含的软件模型有10种，其中常用的有7种：类图、序列图、组件图、部署图、用例图、状态图 和 活动图。

### 类图

类图用来描述 *类的特性* 和 *类之间的静态关系*。

* 一个类包含三个部分：*类名 + 属性列表 + 方法列表*
* 类之间有6种静态关系

https://segmentfault.com/a/1190000021317534

||||
-----------------------------|----------------------------------------|----------------------------
依赖 Dependency (use)         | 使用关系（方法的参数指向其他类的对象）      | 带箭头的虚线
关联 Association (交往)       | 引用关系（属性指向其他类的对象）           | 实线，单向带箭头，双向不带箭头
聚合 Aggregation (聚集)       | 整体和部分(弱联系)的关系，如 学校<->老师   | 带空心菱形的实线
组合 Composition (构成)       | 整体和部分(不可分割)的关系，如 身体<->大脑 | 带实心菱形的实线
实现 Implemention (implement) | 接口和实现的关系                         | 带空心箭头的虚线
泛化 Generlization (extend)   | 继承关系(推广、普及)                     | 带空心箭头的实线

<image src="https://static001.geekbang.org/resource/image/5e/61/5e3579a02b2aebf8d57af2f0bf69ac61.jpg" width="720">

### 时序图

时序图用来描述参与者之间的 *动态调用关系*，即，描述 *不同参与者之间的交互*。

* 每个参与者有一条 *垂直向下的生命线*
* 参与者之间的消息 *从上到下表示其调用的前后顺序关系*
* 每个生命线上都有若干个 *激活条*，表示参与者当前处于激活状态

`dispatch`    `return`    `self call`    `callback`

<image src="https://static001.geekbang.org/resource/image/31/c7/31effd0d543f441f62a386e76c290fc7.jpg" width="720">

### 组件图

组件是比类粒度更大的元素。组件图描述 *组件之间的静态关系*，主要是 *依赖关系*。

如果想要描述组件之间的动态调用关系可以使用 *组件时序图*。

<image src="https://static001.geekbang.org/resource/image/95/e5/95174d7c145029fd26164bba6c042ae5.jpg" width="720">

### 部署图

部署图是软件系统最终物理呈现的蓝图，根据部署图，所有相关者（如客户老板、工程师）都能清晰地了解到最终运行的系统在物理上是什么样子，并可以此估算服务器 *成本*。

部署图是整个软件设计模型中比较宏观的一种图，是在 *设计早期* 就需要画的一种模型图。只有对部署图达成共识，才能继续后面的细节设计。

<image src="https://static001.geekbang.org/resource/image/d5/09/d5c4b7d3bb3d2ce1649118a9ee9a7d09.jpg" width="480">

### 用例图

用例图通过反映用户和软件系统的 *交互*，描述系统的 *功能需求*。

* 图中小人形象的元素，被称为 *角色*，角色可以是人，也可以是其他的系统。
* 系统的功能可能会很复杂，所以一张用例图可能只包含其中 *一小部分功能*，这些功能被一个 *矩形框* 框起来，这个矩形框被称为 *用例的边界*。
* 框里的 *椭圆* 表示一个一个的功能，功能之间可以调用依赖，也可以进行功能扩展。

<image src="https://static001.geekbang.org/resource/image/e5/17/e5fc82a9164e324766d5c3f1da1f5817.jpg" width="480">

### 状态图

状态图用来展示 *单个对象生命周期的状态变迁*。

<image src="https://static001.geekbang.org/resource/image/be/a1/bed856dee1e08cefbbd60f24643850a1.jpg" width="480">

### 活动图

活动图主要用来描述 *过程逻辑和业务流程*。*UML中没有流程图*，很多时候，人们用活动图代替流程图。

* 实心圆 代表流程开始
* 空心圆 代表流程结束
* 圆角矩形 表示活动
* 菱形 表示分支判断
* *泳道*：将活动根据领域、系统和角色等划分到不同的泳道中，使流程边界更加清晰

<image src="https://static001.geekbang.org/resource/image/c8/41/c87dca4b7a9a5d1a08318e96a711a541.jpg" width="720">


## 软件设计文档

在每个设计阶段使用几种UML模型对领域或者系统进行建模，再给模型配上必要的文字说明，就可以构成一篇软件设计文档了。

软件设计过程可以拆分成三个阶段
* *需求分析阶段*
  - 通过 *用例图* 来描述系统的功能与使用场景
  - 通过 *活动图* 描述关键的业务流程
  - 如果需要和现有的子系统整合，可以通过 *时序图* 描述新系统和原来的子系统间的调用关系
  - 通过 *简化的类图* 进行领域模型抽象，并描述核心领域对象之间的关系
  - 如果某些对象内部有复杂的状态变化，可以用 *状态图* 进行描述
* *概要设计阶段*
  - 通过 *部署图* 描述系统最终的蓝图
  - 通过 *组件图* 以及 *组件时序图* 设计软件主要模块及其关系
  - 通过 *组件活动图* 描述组件间的流程逻辑
* *详细设计阶段*
  - 主要输出就是 *类图* 和 *类的时序图*，指导最终的代码开发
  - 如果某个类方法内部有比较复杂的逻辑，那么可以将这个方法的逻辑用 *活动图* 进行描述

设计文档的写法并没有一定之规，最重要的是这个文档能否 *向读者传递出架构师完整的设计意图*。而不同的阅读者关注点是不同的。

* 客户和测试人员可能更关注 *功能性需求和实现逻辑*
* 老板和运维人员可能更关注 *非功能需求和整体架构*
* 开发人员可能更关注 *整体架构与关键技术细节*

架构、系统，文档、相关人员之间的关系可以参考下面这张图。

<image src="https://static001.geekbang.org/resource/image/29/d1/29045ffff5888a9cff39c1358eb1dbd1.jpg" width="480">


## 绘图工具


* draw.io https://github.com/jgraph/drawio-desktop 可以作为主力工具，开源，够用
* ProcessOn https://www.processon.com/ 收费，很多在线模板值得学习借鉴
* excalidraw https://excalidraw.com/ 手绘风格

* 技术文章配图指南 https://draveness.me/sketch-and-sketch/




